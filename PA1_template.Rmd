---
title: "Course Project 1"
author: "r2hui"
date: "Sunday, June 5, 2016"
output: html_document
---

This is a R markdown file for assessing monitoring data from devices such as the Fitbit, Nike Fuelband or Jawbone.

## Loading and preprocessing the data

The first part sets the working directory and loads required packages.
```{r, echo=TRUE}
setwd("F:/Documents/Hobbies/Data Science/5 - Reproducible Research/PeerAssess1")
library(reshape)
library(reshape2)
```

Read the downloaded comma separated file.
```{r, echo=TRUE}
data <- read.csv("activity.csv")
```
Omit the rows with NA values.
```{r, echo=TRUE}
data2 <- na.omit(data)
```

## What is the mean total number of steps taken per day?

Melt the table according to 'date'
```{r, echo=TRUE}
dat <- melt(data2, id.vars="date")
```
Recast and plot histogram
```{r, echo=TRUE}
datcast <- dcast(dat, date ~ variable, fun.aggregate = sum)
datcast$interval <- NULL
hist(datcast$steps)
```

The total number of steps taken per day is 
```{r, echo=TRUE}
sum(datcast$steps)
```
The mean of the average daily steps is 
```{r, echo=TRUE}
mean(datcast$steps)
```
The median of the average daily steps is
```{r, echo=TRUE}
median(datcast$steps)
```

## What is the average daily activity pattern?
```{r, echo=TRUE}
dat2 <- melt(data2, id.var="interval", measure.var="steps")
dat2cast <- dcast(dat2, interval ~ variable, value.var="value", fun.aggregate = mean)
plot(dat2cast, type="l")
```

The maximum number of steps, on average, happens on the following 5-min interval:
```{r, echo=TRUE}
dat2cast[which.max(dat2cast$steps),]
```

## Imputting missing values

The total number of missing values (rows) in the data set is:
```{r, echo=TRUE}
nrow(data)-nrow(data2)
```

Missing values (NA) will be written with the mean for the respective 5-min interval
```{r, echo=TRUE}
dataWriteNA <- data
for (i in 1:17568)
{
if (is.na(dataWriteNA[i,1])) {
  dataWriteNA[i,1] <- dat2cast[which(dat2cast$interval == dataWriteNA[i,3]),2]
                      }
}
head(dataWriteNA)

datWriteNA <- melt(dataWriteNA, id.vars="date")
datcastWriteNA <- dcast(datWriteNA, date ~ variable, fun.aggregate = sum)
datcastWriteNA$interval <- NULL
hist(datcastWriteNA$steps)
```

The mean of the average daily steps, with replaced missing values, is:
```{r, echo=TRUE}
mean(datcastWriteNA$steps)
```
The median of the average daily steps, with replaced missing values, is:
```{r, echo=TRUE}
median(datcastWriteNA$steps)
```

There is a difference in the median total number of steps from the first part of the assignment. There is virtually no impact in imputing missing data on the estimates of the total daily number of steps.

## Are there differences in activity patterns between weekdays and weekends?
```{r, echo=TRUE}
dataWriteNA$day <- weekdays(as.Date(dataWriteNA$date))

for (i in 1:17568)
{
  if (dataWriteNA[i,4] %in% c("Saturday","Sunday")) {
    dataWriteNA[i,5] <- "weekend"}
    else {
      dataWriteNA[i,5] <- "weekday"
    }
}

dataWriteNA_WE <- melt(subset(dataWriteNA,dataWriteNA$V5!="weekday"), id.var="interval", measure.var="steps")
datacastWriteNA_WE <- dcast(dataWriteNA_WE, interval ~ variable, value.var="value", fun.aggregate = mean)


dataWriteNA_WD <- melt(subset(dataWriteNA,dataWriteNA$V5!="weekend"), id.var="interval", measure.var="steps")
datacastWriteNA_WD <- dcast(dataWriteNA_WD, interval ~ variable, value.var="value", fun.aggregate = mean)

par(mfrow=c(2,1))
plot(datacastWriteNA_WE, type="l", main="Weekend")
plot(datacastWriteNA_WD, type="l", main="weekday")

```


